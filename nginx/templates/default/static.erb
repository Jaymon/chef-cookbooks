
<% if @ssl_certificate %>
# redirect all requests to ssl
server {
  listen   80;
  listen   [::]:80;
  server_name <%= @host %>;
  return 301 https://$host$request_uri;
}
<% end %>

server {

  listen <%= @port %> default_server;

  charset utf-8;
  server_name <%= @host %>;
  root <%= @root %>;

  <% if @ssl_certificate %>
  ssl on;
  ssl_certificate <%= @ssl_certificate %>;
  ssl_certificate_key <%= @ssl_certificate_key %>;

  ssl_session_timeout 5m;

  ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers "HIGH:!aNULL:!MD5 or HIGH:!aNULL:!MD5:!3DES";
  ssl_prefer_server_ciphers on;
  <% end %>

  access_log /var/log/nginx/access.<%= @server_name %>.log;
  error_log /var/log/nginx/error.<%= @server_name %>.log;

  index index.html index.htm;

  location / {
    # First attempt to serve request as file, then
    # as directory, then fall back to displaying a 404.
    try_files $uri $uri/ =404;
  }

}




